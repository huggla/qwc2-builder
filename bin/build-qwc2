#!/bin/sh
{
startdir=`pwd`
install="yarn install --cache-folder /home/user/.cache"
configure="cp -rf /qwc2conf/* ./"
update="yarn run prod --cache-folder /home/user/.cache"
replace="rsync -av /usr/local/src/qwc2-demo-app/ /qwc2"
chuser="chpst -u ${USER}"
cd /usr/local/src/qwc2-demo-app
echo
if [ "`id -u`" -eq 0 ]
then
    chmod o+x /root \
 && $chuser $install \
 && $chuser $configure \
 && $chuser $update \
 && chmod o-x /root \
 && echo 'Please wait, copying files to /qwc2...' \
 && $chuser $replace \
 && echo 'Done!'
else
    $install \
 && $configure \
 && $update \
 && echo 'Please wait, copying files to /qwc2...' \
 && $replace \
 && echo 'Done!'
fi
cd $startdir
} 2>&1 | tee -a /var/log/stdout+stderr.log &
exit
