#!/bin/sh
{
  startdir=`pwd`
  chuser="chpst -u ${USER}"
  configure="cp -rf /qwc2conf/* /qwc2"
  createyarnrc="touch /usr/local/src/qwc2-demo-app/yarnrc"
  update="yarn run themesconfig --cache-folder /usr/local/src/qwc2-demo-app/cache --global-folder /usr/local/src/qwc2-demo-app/global"
  cd /qwc2
  if [ "`id -u`" -eq 0 ]
  then
       chmod o+x /root \
    && $chuser $createyarnrc \
    && $chuser $configure \
    && $chuser $update \
    && chmod o-x /root
  else
       $createyarnrc \
    && $configure \
    && $update
  fi
  rm -rf /usr/local/src/qwc2-demo-app/{,.[!.],..?}*
  cd $startdir
  echo 'DONE!'
} 2>&1 | tee -a /var/log/stdout+stderr.log
exit
